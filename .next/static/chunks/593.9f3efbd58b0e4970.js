(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[593],{4960:function(){},6759:function(){},6272:function(){},3042:function(e,t,i){"use strict";i.r(t),i.d(t,{Editor:function(){return Y},EditorWithStore:function(){return EditorWithStore}});var a=i(7437),n=i(4614),l=i(2265),s=i(4256);function getUid(){return Math.random().toString(36).substring(2,9)}function isHtmlVideoElement(e){return!!e&&"VIDEO"===e.tagName}function isHtmlImageElement(e){return!!e&&"IMG"===e.tagName}function isHtmlAudioElement(e){return!!e&&"AUDIO"===e.tagName}function formatTimeToMinSec(e){return"".concat(Math.floor(e/60),":").concat(appendZero(Math.floor(e%60),2))}function formatTimeToMinSecMili(e){let t=Math.floor(e%1e3/10);return formatTimeToMinSec(e/1e3)+".".concat(appendZero(t,2))}function appendZero(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return e.toString().padStart(t,"0")}var o=i(8674);let r=n.fabric.util.createClass(n.fabric.Image,{type:"coverImage",customFilter:"none",disableCrop:!1,cropWidth:0,cropHeight:0,initialize(e,t){t=t||{},t=Object.assign({cropHeight:this.height,cropWidth:this.width},t),this.callSuper("initialize",e,t)},getCrop(e,t){let i,a;let n=t.width,l=t.height,s=n/l,o=e.width/e.height;s>=o?(i=e.width,a=e.width/s):(i=e.height*s,a=e.height);let r=(e.width-i)/2,d=(e.height-a)/2;return{cropX:r,cropY:d,cropWidth:i,cropHeight:a}},_render(e){if(this.disableCrop){this.callSuper("_render",e);return}let t=this.width,i=this.height,a=this.getCrop(this.getOriginalSize(),{width:this.getScaledWidth(),height:this.getScaledHeight()}),{cropX:n,cropY:l,cropWidth:s,cropHeight:o}=a;e.save();let r=this.customFilter;e.filter=getFilterFromEffectType(r),e.drawImage(this._element,Math.max(n,0),Math.max(l,0),Math.max(1,s),Math.max(1,o),-t/2,-i/2,Math.max(0,t),Math.max(0,i)),e.filter="none",e.restore()}}),d=n.fabric.util.createClass(n.fabric.Image,{type:"coverVideo",customFilter:"none",disableCrop:!1,cropWidth:0,cropHeight:0,initialize(e,t){t=t||{},t=Object.assign({cropHeight:this.height,cropWidth:this.width},t),this.callSuper("initialize",e,t)},getCrop(e,t){let i,a;let n=t.width,l=t.height,s=n/l,o=e.width/e.height;s>=o?(i=e.width,a=e.width/s):(i=e.height*s,a=e.height);let r=(e.width-i)/2,d=(e.height-a)/2;return{cropX:r,cropY:d,cropWidth:i,cropHeight:a}},_render(e){if(this.disableCrop){this.callSuper("_render",e);return}let t=this.width,i=this.height,a=this.getCrop(this.getOriginalSize(),{width:this.getScaledWidth(),height:this.getScaledHeight()}),{cropX:n,cropY:l,cropWidth:s,cropHeight:o}=a,r=this._element,d=r.width/r.videoWidth,c=r.height/r.videoHeight;e.save();let m=this.customFilter;e.filter=getFilterFromEffectType(m),e.drawImage(this._element,Math.max(n,0)/d,Math.max(l,0)/c,Math.max(1,s)/d,Math.max(1,o)/c,-t/2,-i/2,Math.max(0,t),Math.max(0,i)),e.filter="none",e.restore()}});function getFilterFromEffectType(e){switch(e){case"blackAndWhite":return"grayscale(100%)";case"sepia":return"sepia(100%)";case"invert":return"invert(100%)";case"saturate":return"saturate(100%)";default:return"none"}}n.fabric.CoverImage=r,n.fabric.CoverVideo=d;let FabricUitls=class FabricUitls{static getClipMaskRect(e,t){let i=t/e.placement.scaleX,a=i/e.placement.scaleY,l=new n.fabric.Rect({left:e.placement.x-i,top:e.placement.y-a,width:e.placement.width+2*i,height:e.placement.height+2*a,scaleX:e.placement.scaleX,scaleY:e.placement.scaleY,absolutePositioned:!0,fill:"transparent",stroke:"transparent",opacity:.5,strokeWidth:0});return l}};var c=i(2969),m=i(8906);let Store_Store=class Store_Store{get currentTimeInMs(){return 1e3*this.currentKeyFrame/this.fps}setCurrentTimeInMs(e){this.currentKeyFrame=Math.floor(e/1e3*this.fps)}setSelectedMenuOption(e){this.selectedMenuOption=e}setCanvas(e){this.canvas=e,e&&(e.backgroundColor=this.backgroundColor)}setBackgroundColor(e){this.backgroundColor=e,this.canvas&&(this.canvas.backgroundColor=e)}updateEffect(e,t){let i=this.editorElements.findIndex(t=>t.id===e),a=this.editorElements[i];(isEditorVideoElement(a)||isEditorImageElement(a))&&(a.properties.effect=t),this.refreshElements()}setVideos(e){this.videos=e}addVideoResource(e){this.videos=[...this.videos,e]}addAudioResource(e){this.audios=[...this.audios,e]}addImageResource(e){this.images=[...this.images,e]}addAnimation(e){this.animations=[...this.animations,e],this.refreshAnimations()}updateAnimation(e,t){let i=this.animations.findIndex(t=>t.id===e);this.animations[i]=t,this.refreshAnimations()}refreshAnimations(){o.Z.remove(this.animationTimeLine),this.animationTimeLine=o.Z.timeline({duration:this.maxTime,autoplay:!1});for(let o=0;o<this.animations.length;o++){var e,t,i,a,l,s,r;let d=this.animations[o],c=this.editorElements.find(e=>e.id===d.targetId),m=null==c?void 0:c.fabricObject;if(c&&m)switch(m.clipPath=void 0,d.type){case"fadeIn":this.animationTimeLine.add({opacity:[0,1],duration:d.duration,targets:m,easing:"linear"},c.timeFrame.start);break;case"fadeOut":this.animationTimeLine.add({opacity:[1,0],duration:d.duration,targets:m,easing:"linear"},c.timeFrame.end-d.duration);break;case"slideIn":{let a=d.properties.direction,l={left:c.placement.x,top:c.placement.y},s={left:"left"===a?-c.placement.width:"right"===a?null===(e=this.canvas)||void 0===e?void 0:e.width:c.placement.x,top:"top"===a?-c.placement.height:"bottom"===a?null===(t=this.canvas)||void 0===t?void 0:t.height:c.placement.y};if(d.properties.useClipPath){let e=FabricUitls.getClipMaskRect(c,50);m.set("clipPath",e)}if("text"===c.type&&"character"===d.properties.textType){null===(i=this.canvas)||void 0===i||i.remove(...c.properties.splittedTexts),c.properties.splittedTexts=function(e,t){var i,a,l;let s=[],o=(null!==(i=e.text)&&void 0!==i?i:"").split("").filter(e=>"\n"!==e),r=e.__charBounds;if(!r)return[];let d=r.map((e,t)=>e.slice(0,e.length-1).map(e=>({m:e,index:t}))).flat(),c=e.getHeightOfLine(0);for(let i=0;i<o.length;i++){if(!d[i])continue;let{m:r,index:m}=d[i],h=o[i],p=null!==(a=e.scaleX)&&void 0!==a?a:1,u=null!==(l=e.scaleY)&&void 0!==l?l:1,x=new n.fabric.Text(h,{left:r.left*p+t.placement.x,scaleX:p,scaleY:u,top:m*c*u+t.placement.y,fontSize:e.fontSize,fontWeight:e.fontWeight,fill:"#fff"});s.push(x)}return s}(c.fabricObject,c),c.properties.splittedTexts.forEach(e=>{this.canvas.add(e)});let e=d.duration/2,t=e/c.properties.splittedTexts.length;for(let i=0;i<c.properties.splittedTexts.length;i++){let a=c.properties.splittedTexts[i],n={left:a.left-c.placement.x,top:a.top-c.placement.y};this.animationTimeLine.add({left:[s.left+n.left,l.left+n.left],top:[s.top+n.top,l.top+n.top],delay:i*t,duration:e,targets:a},c.timeFrame.start)}this.animationTimeLine.add({opacity:[1,0],duration:1,targets:m,easing:"linear"},c.timeFrame.start),this.animationTimeLine.add({opacity:[0,1],duration:1,targets:m,easing:"linear"},c.timeFrame.start+d.duration),this.animationTimeLine.add({opacity:[0,1],duration:1,targets:c.properties.splittedTexts,easing:"linear"},c.timeFrame.start),this.animationTimeLine.add({opacity:[1,0],duration:1,targets:c.properties.splittedTexts,easing:"linear"},c.timeFrame.start+d.duration)}this.animationTimeLine.add({left:[s.left,l.left],top:[s.top,l.top],duration:d.duration,targets:m,easing:"linear"},c.timeFrame.start);break}case"slideOut":{let e=d.properties.direction,t={left:c.placement.x,top:c.placement.y},i={left:"left"===e?-c.placement.width:"right"===e?null===(a=this.canvas)||void 0===a?void 0:a.width:c.placement.x,top:"top"===e?-100-c.placement.height:"bottom"===e?null===(l=this.canvas)||void 0===l?void 0:l.height:c.placement.y};if(d.properties.useClipPath){let e=FabricUitls.getClipMaskRect(c,50);m.set("clipPath",e)}this.animationTimeLine.add({left:[t.left,i.left],top:[t.top,i.top],duration:d.duration,targets:m,easing:"linear"},c.timeFrame.end-d.duration);break}case"breathe":{let e=this.animations.find(e=>e.targetId===d.targetId&&"slideIn"===e.type),t=this.animations.find(e=>e.targetId===d.targetId&&"slideOut"===e.type),i=e?c.timeFrame.start+e.duration:c.timeFrame.start,a=t?c.timeFrame.end-t.duration:c.timeFrame.end;if(i>a)continue;let n=a-i,l=6e4/72*4,o=null!==(s=m.scaleX)&&void 0!==s?s:1,h=null!==(r=m.scaleY)&&void 0!==r?r:1,p=1.05*o,u=1.05*h,x=Math.floor(n/l);if(x<1)continue;let f=[];for(let e=0;e<x;e++)f.push({scaleX:p,scaleY:u}),f.push({scaleX:o,scaleY:h});this.animationTimeLine.add({duration:n,targets:m,keyframes:f,easing:"linear",loop:!0},i)}}}}removeAnimation(e){this.animations=this.animations.filter(t=>t.id!==e),this.refreshAnimations()}setSelectedElement(e){this.selectedElement=e,this.canvas&&((null==e?void 0:e.fabricObject)?this.canvas.setActiveObject(e.fabricObject):this.canvas.discardActiveObject())}updateSelectedElement(){var e;this.selectedElement=null!==(e=this.editorElements.find(e=>{var t;return e.id===(null===(t=this.selectedElement)||void 0===t?void 0:t.id)}))&&void 0!==e?e:null}setEditorElements(e){this.editorElements=e,this.updateSelectedElement(),this.refreshElements()}updateEditorElement(e){this.setEditorElements(this.editorElements.map(t=>t.id===e.id?e:t))}updateEditorElementTimeFrame(e,t){void 0!=t.start&&t.start<0&&(t.start=0),void 0!=t.end&&t.end>this.maxTime&&(t.end=this.maxTime);let i={...e,timeFrame:{...e.timeFrame,...t}};this.updateVideoElements(),this.updateAudioElements(),this.updateEditorElement(i),this.refreshAnimations()}addEditorElement(e){this.setEditorElements([...this.editorElements,e]),this.refreshElements(),this.setSelectedElement(this.editorElements[this.editorElements.length-1])}removeEditorElement(e){this.setEditorElements(this.editorElements.filter(t=>t.id!==e)),this.refreshElements()}setMaxTime(e){this.maxTime=e}setPlaying(e){this.playing=e,this.updateVideoElements(),this.updateAudioElements(),e&&(this.startedTime=Date.now(),this.startedTimePlay=this.currentTimeInMs,requestAnimationFrame(()=>{this.playFrames()}))}playFrames(){if(!this.playing)return;let e=Date.now()-this.startedTime,t=this.startedTimePlay+e;this.updateTimeTo(t),t>this.maxTime?(this.currentKeyFrame=0,this.setPlaying(!1)):requestAnimationFrame(()=>{this.playFrames()})}updateTimeTo(e){this.setCurrentTimeInMs(e),this.animationTimeLine.seek(e),this.canvas&&(this.canvas.backgroundColor=this.backgroundColor),this.editorElements.forEach(t=>{if(!t.fabricObject)return;let i=t.timeFrame.start<=e&&e<=t.timeFrame.end;t.fabricObject.visible=i})}handleSeek(e){this.playing&&this.setPlaying(!1),this.updateTimeTo(e),this.updateVideoElements(),this.updateAudioElements()}addVideo(e){let t=document.getElementById("video-".concat(e));if(!isHtmlVideoElement(t))return;let i=1e3*t.duration,a=t.videoWidth/t.videoHeight,n=getUid();this.addEditorElement({id:n,name:"Media(video) ".concat(e+1),type:"video",placement:{x:0,y:0,width:100*a,height:100,rotation:0,scaleX:1,scaleY:1},timeFrame:{start:0,end:i},properties:{elementId:"video-".concat(n),src:t.src,effect:{type:"none"}}})}addImage(e){let t=document.getElementById("image-".concat(e));if(!isHtmlImageElement(t))return;let i=t.naturalWidth/t.naturalHeight,a=getUid();this.addEditorElement({id:a,name:"Media(image) ".concat(e+1),type:"image",placement:{x:0,y:0,width:100*i,height:100,rotation:0,scaleX:1,scaleY:1},timeFrame:{start:0,end:this.maxTime},properties:{elementId:"image-".concat(a),src:t.src,effect:{type:"none"}}})}addAudio(e){let t=document.getElementById("audio-".concat(e));if(!isHtmlAudioElement(t))return;let i=1e3*t.duration,a=getUid();this.addEditorElement({id:a,name:"Media(audio) ".concat(e+1),type:"audio",placement:{x:0,y:0,width:100,height:100,rotation:0,scaleX:1,scaleY:1},timeFrame:{start:0,end:i},properties:{elementId:"audio-".concat(a),src:t.src}})}addText(e){let t=getUid(),i=this.editorElements.length;this.addEditorElement({id:t,name:"Text ".concat(i+1),type:"text",placement:{x:0,y:0,width:100,height:100,rotation:0,scaleX:1,scaleY:1},timeFrame:{start:0,end:this.maxTime},properties:{text:e.text,fontSize:e.fontSize,fontWeight:e.fontWeight,splittedTexts:[]}})}updateVideoElements(){this.editorElements.filter(e=>"video"===e.type).forEach(e=>{let t=document.getElementById(e.properties.elementId);if(isHtmlVideoElement(t)){let i=(this.currentTimeInMs-e.timeFrame.start)/1e3;t.currentTime=i,this.playing?t.play():t.pause()}})}updateAudioElements(){this.editorElements.filter(e=>"audio"===e.type).forEach(e=>{let t=document.getElementById(e.properties.elementId);if(isHtmlAudioElement(t)){let i=(this.currentTimeInMs-e.timeFrame.start)/1e3;t.currentTime=i,this.playing?t.play():t.pause()}})}setVideoFormat(e){this.selectedVideoFormat=e}async saveCanvasToVideoWithAudio(){await this.saveCanvasToVideoWithAudioWebmMp4()}async saveCanvasToVideoWithAudioWebmMp4(){console.log("modified");let e="mp4"===this.selectedVideoFormat,t=document.getElementById("canvas"),i=t.captureStream(30),a=this.editorElements.filter(isEditorAudioElement),n=[],l=new AudioContext;a.forEach(e=>{let t=document.getElementById(e.properties.elementId),i=l.createMediaElementSource(t),a=l.createMediaStreamDestination();i.connect(a),i.connect(l.destination),n.push(a.stream)}),n.forEach(e=>{i.addTrack(e.getAudioTracks()[0])});let s=document.createElement("video");s.srcObject=i,s.height=500,s.width=800,s.play().then(()=>{let t=new MediaRecorder(i),a=[];t.ondataavailable=function(e){a.push(e.data),console.log("data available")},t.onstop=async function(){let t=new Blob(a,{type:"video/webm"});if(e){let e=new Uint8Array(await t.arrayBuffer()),i=new c.C,a="https://unpkg.com/@ffmpeg/core@0.12.2/dist/umd";await i.load({coreURL:await (0,m.Wn)("".concat(a,"/ffmpeg-core.js"),"text/javascript"),wasmURL:await (0,m.Wn)("".concat(a,"/ffmpeg-core.wasm"),"application/wasm")}),await i.writeFile("video.webm",e),await i.exec(["-y","-i","video.webm","-c:v","libx264","video.mp4"]);let n=await i.readFile("video.mp4"),l=new Blob([n],{type:"video/mp4"}),s=URL.createObjectURL(l),o=document.createElement("a");o.download="video.mp4",o.href=s,o.click()}else{let e=URL.createObjectURL(t),i=document.createElement("a");i.href=e,i.download="video.webm",i.click()}},t.start(),setTimeout(()=>{t.stop()},this.maxTime),s.remove()}).catch(e=>{console.error("Error playing video:",e)})}refreshElements(){let e=this;if(!e.canvas)return;let t=e.canvas;e.canvas.remove(...e.canvas.getObjects());for(let i=0;i<e.editorElements.length;i++){let a=e.editorElements[i];switch(a.type){case"video":{if(console.log("elementid",a.properties.elementId),null==document.getElementById(a.properties.elementId))continue;let i=document.getElementById(a.properties.elementId);if(!isHtmlVideoElement(i))continue;let l=new n.fabric.CoverVideo(i,{name:a.id,left:a.placement.x,top:a.placement.y,width:a.placement.width,height:a.placement.height,scaleX:a.placement.scaleX,scaleY:a.placement.scaleY,angle:a.placement.rotation,objectCaching:!1,selectable:!0,lockUniScaling:!0,customFilter:a.properties.effect.type});a.fabricObject=l,a.properties.imageObject=l,i.width=100,i.height=100*i.videoHeight/i.videoWidth,t.add(l),t.on("object:modified",function(t){var i,n,s;if(!t.target)return;let o=t.target;if(o!=l)return;let r=a.placement,d={...r,x:null!==(i=o.left)&&void 0!==i?i:r.x,y:null!==(n=o.top)&&void 0!==n?n:r.y,rotation:null!==(s=o.angle)&&void 0!==s?s:r.rotation,width:o.width&&o.scaleX?o.width*o.scaleX:r.width,height:o.height&&o.scaleY?o.height*o.scaleY:r.height,scaleX:1,scaleY:1},c={...a,placement:d};e.updateEditorElement(c)});break}case"image":{if(null==document.getElementById(a.properties.elementId))continue;let i=document.getElementById(a.properties.elementId);if(!isHtmlImageElement(i))continue;let l=new n.fabric.CoverImage(i,{name:a.id,left:a.placement.x,top:a.placement.y,angle:a.placement.rotation,objectCaching:!1,selectable:!0,lockUniScaling:!0,customFilter:a.properties.effect.type});a.fabricObject=l,a.properties.imageObject=l;let s={w:i.naturalWidth,h:i.naturalHeight};l.width=s.w,l.height=s.h,i.width=s.w,i.height=s.h,l.scaleToHeight(s.w),l.scaleToWidth(s.h);let o={x:a.placement.width/s.w,y:a.placement.height/s.h};l.scaleX=o.x*a.placement.scaleX,l.scaleY=o.y*a.placement.scaleY,t.add(l),t.on("object:modified",function(t){var i,n,s;if(!t.target)return;let r=t.target;if(r!=l)return;let d=a.placement,c=1;r.scaleX&&r.scaleX>0&&(c=r.scaleX/o.x);let m={...d,x:null!==(i=r.left)&&void 0!==i?i:d.x,y:null!==(n=r.top)&&void 0!==n?n:d.y,rotation:null!==(s=r.angle)&&void 0!==s?s:d.rotation,scaleX:c,scaleY:c},h={...a,placement:m};e.updateEditorElement(h)});break}case"audio":break;case"text":{let i=new n.fabric.Textbox(a.properties.text,{name:a.id,left:a.placement.x,top:a.placement.y,scaleX:a.placement.scaleX,scaleY:a.placement.scaleY,width:a.placement.width,height:a.placement.height,angle:a.placement.rotation,fontSize:a.properties.fontSize,fontWeight:a.properties.fontWeight,objectCaching:!1,selectable:!0,lockUniScaling:!0,fill:"#ffffff"});a.fabricObject=i,t.add(i),t.on("object:modified",function(t){var n,l,s,o,r,d,c;if(!t.target)return;let m=t.target;if(m!=i)return;let h=a.placement,p={...h,x:null!==(n=m.left)&&void 0!==n?n:h.x,y:null!==(l=m.top)&&void 0!==l?l:h.y,rotation:null!==(s=m.angle)&&void 0!==s?s:h.rotation,width:null!==(o=m.width)&&void 0!==o?o:h.width,height:null!==(r=m.height)&&void 0!==r?r:h.height,scaleX:null!==(d=m.scaleX)&&void 0!==d?d:h.scaleX,scaleY:null!==(c=m.scaleY)&&void 0!==c?c:h.scaleY},u={...a,placement:p,properties:{...a.properties,text:null==m?void 0:m.text}};e.updateEditorElement(u)});break}default:throw Error("Not implemented")}a.fabricObject&&a.fabricObject.on("selected",function(t){e.setSelectedElement(a)})}let i=e.selectedElement;i&&i.fabricObject&&t.setActiveObject(i.fabricObject),this.refreshAnimations(),this.updateTimeTo(this.currentTimeInMs),e.canvas.renderAll()}constructor(){this.possibleVideoFormats=["mp4","webm"],this.startedTime=0,this.startedTimePlay=0,this.canvas=null,this.videos=[],this.images=[],this.audios=[],this.editorElements=[],this.backgroundColor="#111111",this.maxTime=3e4,this.playing=!1,this.currentKeyFrame=0,this.selectedElement=null,this.fps=60,this.animations=[],this.animationTimeLine=o.Z.timeline(),this.selectedMenuOption="Video",this.selectedVideoFormat="mp4",(0,s.ky)(this)}};function isEditorAudioElement(e){return"audio"===e.type}function isEditorVideoElement(e){return"video"===e.type}function isEditorImageElement(e){return"image"===e.type}let h=(0,l.createContext)(new Store_Store);var p=i(985);let u=(0,p.Pi)(()=>{let e=l.useContext(h);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-sm px-[16px] pt-[16px] pb-[8px] font-semibold",children:"Export"}),(0,a.jsxs)("div",{className:"px-[16px]",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center my-2",children:[(0,a.jsx)("div",{className:"text-xs font-semibold mr-2",children:"Video Length:"}),(0,a.jsx)("input",{type:"number",className:"rounded text-center border-slate-200 placeholder-slate-400 contrast-more:border-slate-400 contrast-more:placeholder-slate-500 max-w-[50px] mr-2",value:e.maxTime/1e3,onChange:t=>{let i=t.target.value;e.setMaxTime(1e3*Number(i))}}),(0,a.jsx)("div",{children:"secs"})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center my-2",children:[(0,a.jsx)("div",{className:"text-xs font-semibold mr-2",children:"Canvas Resolution:"}),(0,a.jsx)("div",{className:"text-xs mr-2",children:"Todo"})]})]}),(0,a.jsxs)("div",{className:"px-[16px]",children:[(0,a.jsx)("div",{className:"text-xs font-semibold mr-2",children:"Video Format:"}),(0,a.jsxs)("div",{className:"flex flex-row items-center my-2",children:[(0,a.jsx)("input",{type:"radio",className:"mr-2",name:"video-format",value:"mp4",checked:"mp4"===e.selectedVideoFormat,onChange:t=>{e.setVideoFormat("mp4")}}),(0,a.jsx)("div",{className:"text-xs mr-2",children:"MP4"})]})]}),(0,a.jsxs)("button",{className:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-1 px-1 rounded-lg m-4",onClick:()=>{if(e.maxTime<=0){console.error("Invalid video duration");return}if(!e.selectedVideoFormat){console.error("Invalid video format");return}e.handleSeek(0),e.setSelectedElement(null),setTimeout(()=>{e.setPlaying(!0),e.saveCanvasToVideoWithAudio()},1e3)},children:["Export Video (",e.maxTime/1e3," secs) ","mp4"===e.selectedVideoFormat?"ALPHA":""]})]})});var x=i(8910);let f={fadeIn:"Fade In",fadeOut:"Fade Out",slideIn:"Slide In",slideOut:"Slide Out",breath:"Breath"},g=(0,p.Pi)(e=>{let t=l.useContext(h);return(0,a.jsxs)("div",{className:"rounded-lg overflow-hidden items-center bg-slate-800 m-[15px] flex flex-col relative min-h-[100px] p-2",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-between w-full",children:[(0,a.jsx)("div",{className:"text-white py-1 text-base text-left w-full",children:f[e.animation.type]}),(0,a.jsx)("button",{className:"hover:bg-[#00a0f5] bg-[rgba(0,0,0,.25)] rounded z-10 text-white font-bold py-1 text-lg",onClick:()=>t.removeAnimation(e.animation.id),children:(0,a.jsx)(x.ZkW,{size:"25"})})]}),"fadeIn"===e.animation.type||"fadeOut"===e.animation.type?(0,a.jsx)(v,{animation:e.animation}):null,"slideIn"===e.animation.type||"slideOut"===e.animation.type?(0,a.jsx)(b,{animation:e.animation}):null]})}),v=(0,p.Pi)(e=>{let t=l.useContext(h);return(0,a.jsx)("div",{className:"flex flex-col w-full items-start",children:(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between my-1",children:[(0,a.jsx)("div",{className:"text-white text-xs",children:"Duration(s)"}),(0,a.jsx)("input",{className:"bg-slate-100 text-black rounded-lg px-2 py-1 ml-2 w-16 text-xs",type:"number",value:e.animation.duration/1e3,onChange:i=>{let a=1e3*Number(i.target.value),n=a>0?a:0;n<10&&(n=10),t.updateAnimation(e.animation.id,{...e.animation,duration:n})}})]})})}),b=(0,p.Pi)(e=>{let t=l.useContext(h);return(0,a.jsxs)("div",{className:"flex flex-col w-full items-start",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between my-1",children:[(0,a.jsx)("div",{className:"text-white text-xs",children:"Duration(s)"}),(0,a.jsx)("input",{className:"bg-slate-100 text-black rounded-lg px-2 py-1 ml-2 w-16 text-xs",type:"number",value:e.animation.duration/1e3,onChange:i=>{let a=1e3*Number(i.target.value),n=a>0?a:0;n<10&&(n=10),t.updateAnimation(e.animation.id,{...e.animation,duration:n})}})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between my-1",children:[(0,a.jsx)("div",{className:"text-white text-xs",children:"Direction"}),(0,a.jsxs)("select",{className:"bg-slate-100 text-black rounded-lg px-2 py-1 ml-2 w-16 text-xs",value:e.animation.properties.direction,onChange:i=>{t.updateAnimation(e.animation.id,{...e.animation,properties:{...e.animation.properties,direction:i.target.value}})},children:[(0,a.jsx)("option",{value:"left",children:"Left"}),(0,a.jsx)("option",{value:"right",children:"Right"}),(0,a.jsx)("option",{value:"top",children:"Top"}),(0,a.jsx)("option",{value:"bottom",children:"Bottom"})]})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between my-1",children:[(0,a.jsx)("div",{className:"text-white text-xs",children:"Use Mask"}),(0,a.jsx)("input",{className:"bg-slate-100 text-black rounded-lg px-2 py-1 ml-2 w-16 text-xs",type:"checkbox",checked:e.animation.properties.useClipPath,onChange:i=>{t.updateAnimation(e.animation.id,{...e.animation,properties:{...e.animation.properties,useClipPath:i.target.checked}})}})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between my-1",children:[(0,a.jsx)("div",{className:"text-white text-xs",children:"Type"}),(0,a.jsxs)("select",{className:"bg-slate-100 text-black rounded-lg px-2 py-1 ml-2 w-16 text-xs",value:e.animation.properties.textType,onChange:i=>{t.updateAnimation(e.animation.id,{...e.animation,properties:{...e.animation.properties,textType:i.target.value}})},children:[(0,a.jsx)("option",{value:"none",children:"None"}),(0,a.jsx)("option",{value:"character",children:"Character"})]})]})]})}),w=(0,p.Pi)(()=>{let e=l.useContext(h),t=e.selectedElement,i=e.animations.filter(e=>e.targetId===(null==t?void 0:t.id)),n=i.some(e=>"fadeIn"===e.type),s=i.some(e=>"fadeOut"===e.type),o=i.some(e=>"slideIn"===e.type),r=i.some(e=>"slideOut"===e.type),d=i.some(e=>"breathe"===e.type);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-sm px-[16px] pt-[16px] pb-[8px] font-semibold",children:"Animations"}),t&&!n?(0,a.jsx)("div",{className:"text-sm px-[16px] py-[8px] font-semibold hover:bg-slate-700 hover:text-white cursor-pointer",onClick:()=>{var i;e.addAnimation({id:getUid(),type:"fadeIn",targetId:null!==(i=null==t?void 0:t.id)&&void 0!==i?i:"",duration:1e3,properties:{}})},children:"Add Fade In"}):null,t&&!s?(0,a.jsx)("div",{className:"text-sm px-[16px] py-[8px] font-semibold hover:bg-slate-700 hover:text-white cursor-pointer",onClick:()=>{var i;e.addAnimation({id:getUid(),type:"fadeOut",targetId:null!==(i=null==t?void 0:t.id)&&void 0!==i?i:"",duration:1e3,properties:{}})},children:"Add Fade Out"}):null,t&&!o?(0,a.jsx)("div",{className:"text-sm px-[16px] py-[8px] font-semibold hover:bg-slate-700 hover:text-white cursor-pointer",onClick:()=>{var i;e.addAnimation({id:getUid(),type:"slideIn",targetId:null!==(i=null==t?void 0:t.id)&&void 0!==i?i:"",duration:1e3,properties:{direction:"left",useClipPath:!1,textType:"none"}})},children:"Add Slide In"}):null,t&&!r?(0,a.jsx)("div",{className:"text-sm px-[16px] py-[8px] font-semibold hover:bg-slate-700 hover:text-white cursor-pointer",onClick:()=>{var i;e.addAnimation({id:getUid(),type:"slideOut",targetId:null!==(i=null==t?void 0:t.id)&&void 0!==i?i:"",duration:1e3,properties:{direction:"right",useClipPath:!1,textType:"none"}})},children:"Add Slide Out"}):null,t&&!d?(0,a.jsx)("div",{className:"text-sm px-[16px] py-[8px] font-semibold hover:bg-slate-700 hover:text-white cursor-pointer",onClick:()=>{var i;e.addAnimation({id:getUid(),type:"breathe",targetId:null!==(i=null==t?void 0:t.id)&&void 0!==i?i:"",duration:1e3,properties:{}})},children:"Add Breathing"}):null,i.map(e=>(0,a.jsx)(g,{animation:e},e.id))]})}),y=(0,p.Pi)(e=>{let{audio:t,index:i}=e,n=l.useContext(h),s=l.useRef(null),[o,r]=l.useState("00:00");return(0,a.jsxs)("div",{className:"rounded-lg overflow-hidden items-center bg-slate-800 m-[15px] flex flex-col relative min-h-[100px]",children:[(0,a.jsx)("div",{className:"bg-[rgba(0,0,0,.25)] text-white py-1 absolute text-base top-2 right-2",children:o}),(0,a.jsx)("button",{className:"hover:bg-[#00a0f5] bg-[rgba(0,0,0,.25)] rounded z-10 text-white font-bold py-1 absolute text-lg bottom-2 right-2",onClick:()=>n.addAudio(i),children:(0,a.jsx)(x.x06,{size:"25"})}),(0,a.jsx)("audio",{onLoadedData:()=>{var e,t;let i=null!==(t=null===(e=s.current)||void 0===e?void 0:e.duration)&&void 0!==t?t:0;r(formatTimeToMinSec(i))},ref:s,className:"max-h-[100px] max-w-[150px] min-h-[50px] min-w-[100px]",src:t,id:"audio-".concat(i)})]})}),UploadButton=e=>(0,a.jsxs)("label",{htmlFor:"fileInput",className:e.className,children:[(0,a.jsx)("input",{id:"fileInput",type:"file",accept:e.accept,className:"hidden",onChange:e.onChange}),"Upload"]}),j=(0,p.Pi)(()=>{let e=l.useContext(h);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-sm px-[16px] pt-[16px] pb-[8px] font-semibold",children:"Audios"}),e.audios.map((e,t)=>(0,a.jsx)(y,{audio:e,index:t},e)),(0,a.jsx)(UploadButton,{accept:"audio/mp3,audio/*",className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold text-center mx-2 py-2 px-4 rounded cursor-pointer",onChange:t=>{var i;let a=null===(i=t.target.files)||void 0===i?void 0:i[0];a&&e.addAudioResource(URL.createObjectURL(a))}})]})});var E=i(9119);let C=["#000000","#FFFFFF","#404040","#808080","#C0C0C0","#E0E0E0","#003366","#336699","#6699CC","#99CCFF","#990000","#CC3333","#FF6666","#663300","#996633","#CC9966","#006600","#339933","#66CC99","#FFFF00"],N=(0,p.Pi)(()=>{let e=l.useContext(h),[t,i]=(0,l.useState)(!1),handleColorClick=t=>{e.setBackgroundColor(t)},handleClickOutside=e=>{let t=document.getElementById("color-picker");t&&!t.contains(e.target)&&i(!1)};return l.useEffect(()=>(t?document.addEventListener("mousedown",handleClickOutside):document.removeEventListener("mousedown",handleClickOutside),()=>{document.removeEventListener("mousedown",handleClickOutside)}),[t]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-sm px-[16px] pt-[16px] pb-[8px] font-semibold",children:"Background Colour"}),(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)(E.if,{colors:C,color:e.backgroundColor,onChangeComplete:e=>handleColorClick(e.hex)})}),(0,a.jsxs)("div",{className:"flex items-center justify-center mt-4",children:[(0,a.jsx)("button",{onClick:()=>{i(!0)},className:"bg-blue-500 text-white px-4 py-2 rounded",children:"Pick a Color"}),t&&(0,a.jsx)("div",{id:"color-picker",style:{position:"absolute",zIndex:2},children:(0,a.jsx)(E.AI,{color:e.backgroundColor,onChangeComplete:e=>handleColorClick(e.hex)})})]})]})}),T=(0,p.Pi)(e=>{let{image:t,index:i}=e,n=l.useContext(h),s=l.useRef(null),[o,r]=l.useState({w:0,h:0});return(0,a.jsxs)("div",{className:"rounded-lg overflow-hidden items-center bg-slate-800 m-[15px] flex flex-col relative",children:[(0,a.jsxs)("div",{className:"bg-[rgba(0,0,0,.25)] text-white py-1 absolute text-base top-2 right-2",children:[o.w,"x",o.h]}),(0,a.jsx)("button",{className:"hover:bg-[#00a0f5] bg-[rgba(0,0,0,.25)] rounded z-10 text-white font-bold py-1 absolute text-lg bottom-2 right-2",onClick:()=>n.addImage(i),children:(0,a.jsx)(x.x06,{size:"25"})}),(0,a.jsx)("img",{onLoad:()=>{var e,t,i,a;r({w:null!==(i=null===(e=s.current)||void 0===e?void 0:e.naturalWidth)&&void 0!==i?i:0,h:null!==(a=null===(t=s.current)||void 0===t?void 0:t.naturalHeight)&&void 0!==a?a:0})},ref:s,className:"max-h-[100px] max-w-[150px]",src:t,height:200,width:200,id:"image-".concat(i)})]})}),k=(0,p.Pi)(()=>{let e=l.useContext(h);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-sm px-[16px] pt-[16px] pb-[8px] font-semibold",children:"Images"}),(0,a.jsx)(UploadButton,{accept:"image/*",className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold text-center mx-2 py-2 px-4 rounded cursor-pointer",onChange:t=>{var i;let a=null===(i=t.target.files)||void 0===i?void 0:i[0];a&&e.addImageResource(URL.createObjectURL(a))}}),(0,a.jsx)("div",{children:e.images.map((e,t)=>(0,a.jsx)(T,{image:e,index:t},e))})]})}),F=(0,p.Pi)(e=>{let{fontSize:t,fontWeight:i,sampleText:n}=e,s=l.useContext(h);return(0,a.jsxs)("div",{className:"items-center m-[15px] flex flex-row",children:[(0,a.jsx)("div",{className:"flex-1 text-black px-2 py-1",style:{fontSize:"".concat(t,"px"),fontWeight:"".concat(i)},children:n}),(0,a.jsx)("button",{className:"h-[32px] w-[32px] hover:bg-black bg-[rgba(0,0,0,.25)] rounded z-10 text-white font-bold py-1 flex items-center justify-center",onClick:()=>s.addText({text:n,fontSize:t,fontWeight:i}),children:(0,a.jsx)(x.x06,{size:"25"})})]})}),S=[{name:"Title",fontSize:28,fontWeight:600},{name:"Subtitle",fontSize:16,fontWeight:600},{name:"Body",fontSize:14,fontWeight:400},{name:"Caption",fontSize:12,fontWeight:400},{name:"Heading 1",fontSize:24,fontWeight:800},{name:"Heading 2",fontSize:20,fontWeight:800},{name:"Heading 3",fontSize:18,fontWeight:800},{name:"Heading 4",fontSize:16,fontWeight:800},{name:"Heading 5",fontSize:14,fontWeight:800},{name:"Heading 6",fontSize:12,fontWeight:800}],I=(0,p.Pi)(()=>(0,a.jsxs)("div",{className:"bg-slate-200 h-full",children:[(0,a.jsx)("div",{className:"text-sm px-[16px] pt-[16px] pb-[8px] font-semibold text-black",children:"Text"}),(0,a.jsx)("ul",{children:S.map(e=>(0,a.jsx)("li",{children:(0,a.jsx)(F,{sampleText:e.name,fontSize:e.fontSize,fontWeight:e.fontWeight})},e.name))})]})),M=(0,p.Pi)(e=>{let{video:t,index:i}=e,n=l.useContext(h),s=l.useRef(null),[o,r]=l.useState("00:00");return(0,a.jsxs)("div",{className:"rounded-lg overflow-hidden items-center bg-slate-800 m-[15px] flex flex-col relative",children:[(0,a.jsx)("div",{className:"bg-[rgba(0,0,0,.25)] text-white py-1 absolute text-base top-2 right-2",children:o}),(0,a.jsx)("button",{className:"hover:bg-[#00a0f5] bg-[rgba(0,0,0,.25)] rounded z-10 text-white font-bold py-1 absolute text-lg bottom-2 right-2",onClick:()=>n.addVideo(i),children:(0,a.jsx)(x.x06,{size:"25"})}),(0,a.jsx)("video",{onLoadedData:()=>{var e,t;let i=null!==(t=null===(e=s.current)||void 0===e?void 0:e.duration)&&void 0!==t?t:0;r(formatTimeToMinSec(i))},ref:s,className:"max-h-[150px] max-w-[150px]",src:t,height:200,width:200,id:"video-".concat(i)})]})}),O=(0,p.Pi)(()=>{let e=l.useContext(h);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-sm px-[16px] pt-[16px] pb-[8px] font-semibold",children:"Videos"}),e.videos.map((e,t)=>(0,a.jsx)(M,{video:e,index:t},e)),(0,a.jsx)(UploadButton,{accept:"video/mp4,video/x-m4v,video/*",className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold text-center mx-2 py-2 px-4 rounded cursor-pointer",onChange:t=>{var i;let a=null===(i=t.target.files)||void 0===i?void 0:i[0];a&&e.addVideoResource(URL.createObjectURL(a))}})]})}),A={blackAndWhite:"Black and White",none:"None",saturate:"Saturate",sepia:"Sepia",invert:"Invert"},z=(0,p.Pi)(e=>{let t=l.useContext(h);return(0,a.jsxs)("div",{className:"rounded-lg overflow-hidden items-center bg-slate-800 m-[15px] flex flex-col relative min-h-[100px] p-2",children:[(0,a.jsx)("div",{className:"flex flex-row justify-between w-full",children:(0,a.jsx)("div",{className:"text-white py-1 text-base text-left w-full",children:A[e.editorElement.properties.effect.type]})}),(0,a.jsx)("select",{className:"bg-slate-100 text-black rounded-lg px-2 py-1 ml-2 w-16 text-xs",value:e.editorElement.properties.effect.type,onChange:i=>{let a=i.target.value;t.updateEffect(e.editorElement.id,{type:a})},children:Object.keys(A).map(e=>(0,a.jsx)("option",{value:e,children:A[e]},e))})]})}),W=(0,p.Pi)(()=>{let e=l.useContext(h),t=e.selectedElement;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-sm px-[16px] pt-[16px] pb-[8px] font-semibold",children:"Effects"}),t&&(isEditorImageElement(t)||isEditorVideoElement(t))?(0,a.jsx)(z,{editorElement:t}):null]})}),P=(0,p.Pi)(()=>{let e=l.useContext(h),t=e.selectedMenuOption;return(0,a.jsxs)("div",{className:"bg-slate-200 h-full",children:["Video"===t?(0,a.jsx)(O,{}):null,"Audio"===t?(0,a.jsx)(j,{}):null,"Image"===t?(0,a.jsx)(k,{}):null,"Text"===t?(0,a.jsx)(I,{}):null,"Animation"===t?(0,a.jsx)(w,{}):null,"Effect"===t?(0,a.jsx)(W,{}):null,"Export"===t?(0,a.jsx)(u,{}):null,"Fill"===t?(0,a.jsx)(N,{}):null]})}),L=(0,p.Pi)(e=>{var t;let i=l.useContext(h),{element:n}=e,s="video"===n.type?x.laJ:x.FxN,o=(null===(t=i.selectedElement)||void 0===t?void 0:t.id)===n.id,r=o?"rgba(0, 160, 245, 0.1)":"";return(0,a.jsxs)("div",{style:{backgroundColor:r},className:"flex mx-2 my-1 py-2 px-1 flex-row justify-start items-center ".concat(r),onClick:()=>{i.setSelectedElement(n)},children:[(0,a.jsx)(s,{size:"20",color:"gray"}),(0,a.jsx)("div",{className:"truncate text-xs ml-2 flex-1 font-medium",children:n.name}),(0,a.jsxs)("div",{children:["video"===n.type?(0,a.jsx)("video",{className:"opacity-0 max-w-[20px] max-h-[20px]",src:n.properties.src,onLoad:()=>{i.refreshElements()},onLoadedData:()=>{i.refreshElements()},height:20,width:20,id:n.properties.elementId}):null,"image"===n.type?(0,a.jsx)("img",{className:"opacity-0 max-w-[20px] max-h-[20px]",src:n.properties.src,onLoad:()=>{i.refreshElements()},onLoadedData:()=>{i.refreshElements()},height:20,width:20,id:n.properties.elementId}):null,"audio"===n.type?(0,a.jsx)("audio",{className:"opacity-0 max-w-[20px] max-h-[20px]",src:n.properties.src,onLoad:()=>{i.refreshElements()},onLoadedData:()=>{i.refreshElements()},id:n.properties.elementId}):null]}),(0,a.jsx)("button",{className:"bg-red-500 hover:bg-red-700 text-white mr-2 text-xs py-0 px-1 rounded",onClick:e=>{i.removeEditorElement(n.id),i.refreshElements(),e.preventDefault(),e.stopPropagation()},children:"X"})]},n.id)}),V=(0,p.Pi)(e=>{let t=l.useContext(h);return(0,a.jsxs)("div",{className:"bg-slate-200 h-full overflow-scroll",children:[(0,a.jsx)("div",{className:"flex flex-row justify-between",children:(0,a.jsx)("div",{className:"text-sm px-[16px] py-[7px] font-semibold",children:"Elements"})}),(0,a.jsx)("div",{className:"flex flex-col",children:t.editorElements.map(e=>(0,a.jsx)(L,{element:e},e.id))})]})}),U=(0,p.Pi)(()=>{let e=l.useContext(h);return(0,a.jsx)("ul",{className:"bg-white h-full",children:X.map(t=>{let i=e.selectedMenuOption===t.name;return(0,a.jsx)("li",{className:"h-[72px] w-[72px] flex flex-col items-center justify-center ".concat(i?"bg-slate-200":""),children:(0,a.jsxs)("button",{onClick:()=>t.action(e),className:"flex flex-col items-center",children:[(0,a.jsx)(t.icon,{size:"20",color:i?"#000":"#444"}),(0,a.jsx)("div",{className:"text-[0.6rem] hover:text-black ".concat(i?"text-black":"text-slate-600"),children:t.name})]})},t.name)})})}),X=[{name:"Video",icon:x.dnC,action:e=>{e.setSelectedMenuOption("Video")}},{name:"Audio",icon:x.ibD,action:e=>{e.setSelectedMenuOption("Audio")}},{name:"Image",icon:x.e0s,action:e=>{e.setSelectedMenuOption("Image")}},{name:"Text",icon:x.SQS,action:e=>{e.setSelectedMenuOption("Text")}},{name:"Animation",icon:x.mi9,action:e=>{e.setSelectedMenuOption("Animation")}},{name:"Effect",icon:x._9Q,action:e=>{e.setSelectedMenuOption("Effect")}},{name:"Fill",icon:x.Yu2,action:e=>{e.setSelectedMenuOption("Fill")}},{name:"Export",icon:x.uKn,action:e=>{e.setSelectedMenuOption("Export")}}];var R=i(1100);let ScaleRangeInput=e=>{let{max:t,value:i,onChange:n}=e,s=(0,l.useRef)(null),o=(0,l.useRef)(!1),[r,d]=(0,l.useState)({width:50,height:e.height});(0,l.useEffect)(()=>{let handleResize=()=>{if(s.current){var t,i,a,n;d({width:null!==(a=null===(t=s.current.parentElement)||void 0===t?void 0:t.clientWidth)&&void 0!==a?a:50,height:null!==(n=null===(i=s.current.parentElement)||void 0===i?void 0:i.clientHeight)&&void 0!==n?n:e.height})}};return window.addEventListener("resize",handleResize),handleResize(),()=>{window.removeEventListener("resize",handleResize)}},[]),(0,l.useEffect)(()=>{if(s.current){let i=s.current;i.width=r.width,i.height=r.height;let a=i.getContext("2d");a&&(a.fillStyle=e.backgroundColor,a.fillRect(0,0,i.width,i.height),e.markings.forEach(e=>{a.strokeStyle=e.color,a.lineWidth=e.width,a.beginPath();for(let n=0;n<t;n+=e.interval)a.moveTo(n/t*i.width,0),a.lineTo(n/t*i.width,e.size);a.stroke()}))}},[e.markings,e.backgroundColor,t,r]);let updateFromMouseEvent=e=>{var i;let a=null===(i=s.current)||void 0===i?void 0:i.getBoundingClientRect();if(a){let i=e.clientX-a.left,l=i/r.width*t,s=Math.min(t,Math.max(0,l));n(s)}};return(0,a.jsxs)("div",{className:"relative w-full",onMouseDown:e=>{o.current=!0,updateFromMouseEvent(e)},onMouseUp:e=>{o.current=!1},onMouseMove:e=>{o.current&&updateFromMouseEvent(e)},onMouseLeave:e=>{o.current=!1},children:[(0,a.jsx)("canvas",{height:e.height,ref:s}),(0,a.jsx)("div",{className:"rounded-full bg-black w-[4px] absolute top-0 left-0",style:{height:"".concat(e.height,"px"),transform:"translateX(".concat(i/t*r.width,"px) translateX(-2px)")}})]})},H=[{interval:5e3,color:"black",size:16,width:1},{interval:1e3,color:"black",size:8,width:1}],B=(0,R.Pi)(e=>{let t=(0,l.useContext)(h),i=t.playing?x.hPq:x.Nhx,n=formatTimeToMinSecMili(t.currentTimeInMs),s=formatTimeToMinSecMili(t.maxTime);return(0,a.jsxs)("div",{className:"seek-player flex flex-col",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center px-2",children:[(0,a.jsx)("button",{className:"w-[80px] rounded  px-2 py-2",onClick:()=>{t.setPlaying(!t.playing)},children:(0,a.jsx)(i,{size:"40"})}),(0,a.jsx)("span",{className:"font-mono",children:n}),(0,a.jsx)("div",{className:"w-[1px] h-[25px] bg-slate-300 mx-[10px]"}),(0,a.jsx)("span",{className:"font-mono",children:s})]}),(0,a.jsx)(ScaleRangeInput,{max:t.maxTime,value:t.currentTimeInMs,onChange:e=>{t.handleSeek(e)},height:30,markings:H,backgroundColor:"white"})]})});var timeline_related_DragableView=function(e){let t=(0,l.useRef)({div:null,isDragging:!1,initialMouseX:0}),{current:i}=t;function calculateNewValue(t){if(!i.div)return 0;let a=t-i.initialMouseX,n=a/i.div.parentElement.clientWidth*e.total;return e.value+n}let handleMouseMove=t=>{i.div&&i.isDragging&&(i.div.style.left="".concat(calculateNewValue(t.clientX)/e.total*100,"%"),t.stopPropagation(),t.preventDefault())},handleMouseUp=t=>{i.div&&i.isDragging&&(i.isDragging=!1,e.onChange(calculateNewValue(t.clientX)),t.stopPropagation(),t.preventDefault())};return(0,l.useEffect)(()=>(window.addEventListener("mouseup",handleMouseUp),window.addEventListener("mousemove",handleMouseMove),()=>{window.removeEventListener("mouseup",handleMouseUp),window.removeEventListener("mousemove",handleMouseMove)}),[handleMouseUp,handleMouseMove]),(0,a.jsx)("div",{ref:e=>{i.div=e},className:"absolute height-100 ".concat(e.className),style:{left:e.value/e.total*100+"%",top:0,bottom:0,...e.style},onMouseDown:t=>{i.div&&(e.disabled||(i.isDragging=!0,i.initialMouseX=t.clientX))},children:e.children})};let _=(0,p.Pi)(e=>{var t;let i=l.useContext(h),{element:n}=e,s="audio"===n.type,o=(null===(t=i.selectedElement)||void 0===t?void 0:t.id)===n.id,r=s?"cursor-no-drop":"cursor-ew-resize";return(0,a.jsxs)("div",{onClick:()=>{i.setSelectedElement(n)},className:"relative width-full h-[25px] my-2 ".concat(o?"border-2 border-indigo-600 bg-slate-200":""),children:[(0,a.jsx)(timeline_related_DragableView,{className:"z-10",value:n.timeFrame.start,total:i.maxTime,disabled:s,onChange:e=>{i.updateEditorElementTimeFrame(n,{start:e})},children:(0,a.jsx)("div",{className:"bg-white border-2 border-blue-400 w-[10px] h-[10px] mt-[calc(25px/2)] translate-y-[-50%] transform translate-x-[-50%] ".concat(r)})}),(0,a.jsx)(timeline_related_DragableView,{className:s?"cursor-no-drop":"cursor-col-resize",value:n.timeFrame.start,disabled:s,style:{width:"".concat((n.timeFrame.end-n.timeFrame.start)/i.maxTime*100,"%")},total:i.maxTime,onChange:e=>{let{start:t,end:a}=n.timeFrame;i.updateEditorElementTimeFrame(n,{start:e,end:e+(a-t)})},children:(0,a.jsx)("div",{className:"".concat(o?"bg-slate-800":"bg-slate-600"," h-full w-full text-white text-xs min-w-[0px] px-2 leading-[25px]"),children:n.name})}),(0,a.jsx)(timeline_related_DragableView,{className:"z-10",disabled:s,value:n.timeFrame.end,total:i.maxTime,onChange:e=>{i.updateEditorElementTimeFrame(n,{end:e})},children:(0,a.jsx)("div",{className:"bg-white border-2 border-blue-400 w-[10px] h-[10px] mt-[calc(25px/2)] translate-y-[-50%] transform translate-x-[-50%] ".concat(r)})})]},n.id)}),D=(0,p.Pi)(()=>{let e=l.useContext(h),t=e.currentTimeInMs/e.maxTime*100;return(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)(B,{}),(0,a.jsxs)("div",{className:"flex-1 relative ",children:[e.editorElements.map(e=>(0,a.jsx)(_,{element:e},e.id)),(0,a.jsx)("div",{className:"w-[2px] bg-red-400 absolute top-0 bottom-0 z-20",style:{left:"".concat(t,"%")}})]})]})}),EditorWithStore=()=>{let[e]=(0,l.useState)(new Store_Store);return(0,a.jsx)(h.Provider,{value:e,children:(0,a.jsx)(Y,{})})},Y=(0,p.Pi)(()=>{let e=l.useContext(h);return(0,l.useEffect)(()=>{let t=new n.fabric.Canvas("canvas",{height:500,width:800,backgroundColor:"#ededed"});n.fabric.Object.prototype.transparentCorners=!1,n.fabric.Object.prototype.cornerColor="#00a0f5",n.fabric.Object.prototype.cornerStyle="circle",n.fabric.Object.prototype.cornerStrokeColor="#0063d8",n.fabric.Object.prototype.cornerSize=10,t.on("mouse:down",function(t){t.target||e.setSelectedElement(null)}),e.setCanvas(t),n.fabric.util.requestAnimFrame(function render(){t.renderAll(),n.fabric.util.requestAnimFrame(render)})},[]),(0,a.jsxs)("div",{className:"grid grid-rows-[500px_1fr_20px] grid-cols-[72px_300px_1fr_250px] h-[100svh]",children:[(0,a.jsx)("div",{className:"tile row-span-2 flex flex-col",children:(0,a.jsx)(U,{})}),(0,a.jsx)("div",{className:"row-span-2 flex flex-col overflow-scroll",children:(0,a.jsx)(P,{})}),(0,a.jsx)("div",{id:"grid-canvas-container",className:"col-start-3 bg-slate-100 flex justify-center items-center",children:(0,a.jsx)("canvas",{id:"canvas",className:"h-[500px] w-[800px] row"})}),(0,a.jsx)("div",{className:"col-start-4 row-start-1",children:(0,a.jsx)(V,{})}),(0,a.jsx)("div",{className:"col-start-3 row-start-2 col-span-2 relative px-[10px] py-[4px] overflow-scroll",children:(0,a.jsx)(D,{})}),(0,a.jsx)("div",{className:"col-span-4 text-right px-2 text-[0.5em] bg-black text-white",children:"Crafted By Hassan Tariq"})]})})}}]);